/********************************************************************************/
/* 客先名		:	標準モジュール												*/
/* 機種名		:	SSFT														*/
/* ﾏｲｺﾝｿﾌﾄﾃｰﾏ名	:	PF															*/
/*==============================================================================*/
/* 作成ﾌｧｲﾙ名	:	SSFTSTD_FR81_Wdt_Drv.c										*/
/* 				:	WDTﾓｼﾞｭｰﾙ													*/
/*==============================================================================*/
/* 対象ﾏｲｺﾝ		:	MB91570 Series												*/
/*==============================================================================*/
/* 作成ﾊﾞｰｼﾞｮﾝ	:	020102														*/
/* 作成年月日	:	2014.3.12													*/
/* 作成者		:	M.Inoue														*/
/*------------------------------------------------------------------------------*/
/* 変更履歴		:																*/
/* [010101]		:	新規作成													*/
/* [010102]		:																*/
/* [010103]		:	間欠起動時の処理追加										*/
/* [010104]		:	HWWDTの処理追加												*/
/* [020101]		:	外部WDT未実装の場合に処理を空関数とするコンフィグ追加		*/
/* [020102]		:	レジスタの定義名変更										*/
/********************************************************************************/

/*** START_INC ***/
/********************************************************************************/
/*   Include File                                                               */
/*------------------------------------------------------------------------------*/
/*      ﾍｯﾀﾞｰﾌｧｲﾙのｲﾝｸﾙｰﾄﾞ文は、下記ﾌｧｲﾙに記載すること                          */
/********************************************************************************/
#include "SSFTSTD_Type.h"
#include "SSFTSTD_Macro.h"
#include "mb91570.h"

#define	 __MB91570_WDT_DRV_INTERNAL__
#include "SSFTSTD_FR81_Wdt_Drv.h"

/*==============================================================================*/
/*	typedef定義（外部非公開）													*/
/*==============================================================================*/
/* なし */

/*==============================================================================*/
/*	関数ﾌﾟﾛﾄﾀｲﾌﾟ宣言（外部非公開)												*/
/*==============================================================================*/
/* なし */

/*==============================================================================*/
/*	内部定数																	*/
/*==============================================================================*/
/* なし */

/****************************************************************************************/
/*	[モジュール名]	WdtDrv_Start			[名称]	内部WDT起動処理						*/
/*======================================================================================*/
/*	[処理概要]	マイコン内臓のソフトウェアウォッチドッグを開始する。					*/
/*======================================================================================*/
/*	[記述形式]	void WdtDrv_Start( void )												*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	WDT0を起動させるためのﾘｾｯﾄ解除後の1回目の書込みを行う。					*/
/*				書き換えﾃﾞｰﾀ→反転ﾃﾞｰﾀを1ｾｯﾄで行うため、								*/
/*				内部WDTｶｳﾝﾀｸﾘｱ処理と同じ処理とする										*/
/****************************************************************************************/
void WdtDrv_Start( void )
{
	
}

/****************************************************************************************/
/*	[モジュール名]	WdtDrv_ReqClr			[名称]	内部WDTｶｳﾝﾀｸﾘｱ処理					*/
/*======================================================================================*/
/*	[処理概要]	ﾏｲｺﾝ内臓のｿﾌﾄｳｪｱｳｫｯﾁﾄﾞｯｸﾞをｸﾘｱする。									*/
/*======================================================================================*/
/*	[記述形式]	void WdtDrv_ReqClr( void )												*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	前回書き込んだ値の全ﾋﾞｯﾄ反転した値を書き込むことでWDT0はｸﾘｱされる。		*/
/*				（ﾘｾｯﾄ解除後の1回目の書き込みでWDT0が起動)								*/
/*				F/Sの観点から、前回値は保持せずにWDT0を2回ｸﾘｱを1ｾｯﾄとしている。			*/
/****************************************************************************************/
void WdtDrv_ReqClr( void )
{
	
	
}

/****************************************************************************************/
/*	[モジュール名]	WdtDrv_ReqClrCpu	[名称]	内部WDTｶｳﾝﾀｸﾘｱ(CPU)処理						*/
/*======================================================================================*/
/*	[処理概要]	ﾏｲｺﾝ内臓のHWのｳｫｯﾁﾄﾞｯｸﾞのｸﾘｱを行う。									*/
/*======================================================================================*/
/*	[記述形式]	void WdtDrv_ReqClrCpuDetect( void )										*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	"0xA5"を書き込むことによりWDT1はｸﾘｱされる。								*/
/*				(リセット解除後にWDT1が起動)											*/
/****************************************************************************************/
void WdtDrv_ReqClrCpu( void )
{
	
	WDTCPR1 = WDT1_CLEAR;
	
}

/****************************************************************************************/
/*	[モジュール名]	WdtDrv_Init		[名称]	WDTﾄﾞﾗｲﾊﾞ初期設定処理						*/
/*======================================================================================*/
/*	[処理概要]	レジスタ初期設定時に本関数を呼び、初期化を行う。						*/
/*======================================================================================*/
/*	[記述形式]	void WdtDrv_Init( E_INIT_TYPE req  )									*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	E_INIT_TYPE				req		：起動種別								*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
void WdtDrv_Init( E_INIT_TYPE req )
{
	
	switch ( req ) {
	case E_INIT_RESET:			/* CPUリセットによる起動 */
	case E_INIT_WAKEUP:			/* 省電力解除（WAKEUP）による起動 */
		/* WDTドライバレジスタ初期化処理 */
		WDTCR0 = INIT_WDTCR0;
		break;
	case E_INIT_IGN_ON:			/* IGN ON */
		break;
	case E_INIT_RET_NORMAL_VOL:	/* 低電圧復帰 */
		break;
	case E_INIT_INTERVAL_WAKEUP:	/* 間欠起動ウェイクアップ */
		/* WDTドライバレジスタ初期化処理 */
		WDTCR0 = INIT_WDTCR0_INTERVAL_WAKEUP;
		break;
	default:					/* 上記以外 */
		break;
	}
	
}

/****************************************************************************************/
/*	[モジュール名]	WdtDrv_Sleep	[名称]	WDTﾄﾞﾗｲﾊﾞ停止設定処理						*/
/*======================================================================================*/
/*	[処理概要]	省電力モード遷移時に本関数を呼び、初期化を行う。						*/
/*======================================================================================*/
/*	[記述形式]	void WdtDrv_Sleep( void )												*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
void WdtDrv_Sleep( void )
{
	/* WDTドライバレジスタの停止設定処理 */
	WDTCR0 = STOP_WDTCR0;
	
}

/****************************************************************************************/
/*	[モジュール名]	WdtDrv_Refresh	[名称]	WDTﾄﾞﾗｲﾊﾞ再設定処理							*/
/*======================================================================================*/
/*	[処理概要]	レジスタ再設定時に本関数を呼び、再設定を行う。							*/
/*======================================================================================*/
/*	[記述形式]	void WdtDrv_Refresh( void )												*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
void WdtDrv_Refresh( void )
{
	
	/* 空関数 */
	
}

/****************************************************************************************/
/*	[モジュール名]	HWWdtDrv_Init		[名称]	ＨＷＷＤＴドライバ初期設定処理			*/
/*======================================================================================*/
/*	[処理概要]	レジスタ初期設定時に本関数を呼び、初期化を行う。						*/
/*======================================================================================*/
/*	[記述形式]	void HWWdtDrv_Init( E_INIT_TYPE req  )									*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	E_INIT_TYPE				req		：起動種別								*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
void HWWdtDrv_Init( E_INIT_TYPE req )
{
#if (WDT_DRV_HWWDT == 1) /* HWWDT有 */
	
	switch ( req ) {
	case E_INIT_RESET:				/* CPUリセットによる起動 */
	case E_INIT_WAKEUP:				/* 省電力解除（WAKEUP）による起動 */
		/* WDTドライバレジスタ初期化処理 */
		/* 空関数 */	
		break;
	case E_INIT_IGN_ON:				/* IGN ON */
		break;
	case E_INIT_RET_NORMAL_VOL:		/* 低電圧復帰 */
		break;
	case E_INIT_INTERVAL_WAKEUP:	/* 間欠起動ウェイクアップ */
		break;
	default:						/* 上記以外 */
		break;
	}
	
#endif /* WDT_DRV_HWWDT */
}

/****************************************************************************************/
/*	[モジュール名]	HWWdtDrv_Sleep	[名称]	ＨＷＷＤＴドライバ再設定処理				*/
/*======================================================================================*/
/*	[処理概要]	省電力モード遷移時に本関数を呼び、初期化を行う。						*/
/*======================================================================================*/
/*	[記述形式]	void HWWdtDrv_Sleep( void )												*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
void HWWdtDrv_Sleep( void )
{
#if (WDT_DRV_HWWDT == 1) /* HWWDT有 */
	/* 空関数 */	
#endif /* WDT_DRV_HWWDT */
}

/****************************************************************************************/
/*	[モジュール名]	HWWdtDrv_Refresh	[名称]	ＨＷＷＤＴドライバ再設定処理			*/
/*======================================================================================*/
/*	[処理概要]	レジスタ再設定時に本関数を呼び、再設定を行う。							*/
/*======================================================================================*/
/*	[記述形式]	void HWWdtDrv_Refresh( void )											*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
void HWWdtDrv_Refresh( void )
{
#if (WDT_DRV_HWWDT == 1) /* HWWDT有 */
	/* 空関数 */
#endif /* WDT_DRV_HWWDT */
}

/****************************************************************************************/
/*	[モジュール名]	HWWdtDrv_ReqCrl	[名称]	外部WDTﾎﾟｰﾄ反転処理（Wake up中）			*/
/*======================================================================================*/
/*	[処理概要]	外部ポートへの反転出力により、外部WDT(HWWDT）をクリアする				*/
/*======================================================================================*/
/*	[記述形式]	void HWWdtDrv_ReqCrl( void )											*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
void HWWdtDrv_ReqCrl( void )
{
#if (WDT_DRV_HWWDT == 1) /* HWWDT有 */
	UI_8 wdt_out;			/* work変数 */

	wdt_out = R_PO_HWWDT;		/* 外部WDTポートデータ取得(volatile変数と演算を切分ける為) */
	wdt_out ^= HWWDTDRV_PORT_TURN;		/* 反転処理 */
	R_PO_HWWDT = wdt_out;		/* 結果を出力 */

#endif /* WDT_DRV_HWWDT */
}

/****************************************************************************************/
/*	[モジュール名]	HWWdtDrv_ReqCrl_Sleep	[名称]	外部WDTﾎﾟｰﾄ反転処理（Sleep中）		*/
/*======================================================================================*/
/*	[処理概要]	外部ポートへのエッジ出力により、外部WDT(HWWDT）をクリアする				*/
/*======================================================================================*/
/*	[記述形式]	void HWWdtDrv_ReqCrl_Sleep( void )										*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
void HWWdtDrv_ReqCrl_Sleep( void )
{
#if (WDT_DRV_HWWDT == 1) /* HWWDT有 */

	R_PO_HWWDT = IO_PO_LEV_NONACT_HWWDT;		/* 外部WDTポートへNonActiveレベルを出力 */

	(void) SysClkDrv_UsecWait(HWWDTDRV_WAIT_TIME);	/* 外部WDTのエッジ入力の為、Wait */

	R_PO_HWWDT = IO_PO_LEV_ACTIVE_HWWDT;		/* 外部WDTポートへActiveレベルを出力 */

#endif /* WDT_DRV_HWWDT */
}
