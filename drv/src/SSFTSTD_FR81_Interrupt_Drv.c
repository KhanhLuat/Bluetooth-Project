/********************************************************************************/
/* 客先名		:	標準モジュール												*/
/* 機種名		:	SSFT														*/
/* ﾏｲｺﾝｿﾌﾄﾃｰﾏ名	:	PF															*/
/*==============================================================================*/
/* 作成ﾌｧｲﾙ名	:	SSFTSTD_FR81_Interrupt_Drv.c								*/
/* 				:	割り込み制御ﾓｼﾞｭｰﾙ											*/
/*==============================================================================*/
/* 対象ﾏｲｺﾝ		:	MB91570 Series												*/
/*==============================================================================*/
/* 作成ﾊﾞｰｼﾞｮﾝ	:	010106														*/
/* 作成年月日	:	2013.07.01													*/
/* 作成者		:	M.Inoue														*/
/*------------------------------------------------------------------------------*/
/* 変更履歴		:																*/
/* [010101]		:	新規作成													*/
/* [010102]		:																*/
/*	12.11.27	:	外部割り込み設定J36A対応									*/
/* [010103]		:																*/
/*	13.3.4		:	FR81S対応													*/
/* [010104]		:																*/
/* [010105]		:	スタンバイ時の処理追加										*/
/* [010106]		:	割込み処理の変更											*/
/********************************************************************************/

/*** START_INC ***/
/********************************************************************************/
/*   Include File                                                               */
/*------------------------------------------------------------------------------*/
/*      ﾍｯﾀﾞｰﾌｧｲﾙのｲﾝｸﾙｰﾄﾞ文は、下記ﾌｧｲﾙに記載すること                          */
/********************************************************************************/
#include "SSFTSTD_Type.h"
#include "SSFTSTD_Macro.h"
#include "mb91570.h"

#define __MB91570_INTERRUPT_DRV_INTERNAL__
#include "SSFTSTD_FR81_Interrupt_Drv.h"


/*==============================================================================*/
/*	typedef定義（外部非公開）													*/
/*==============================================================================*/
/* なし */

/*==============================================================================*/
/*	関数ﾌﾟﾛﾄﾀｲﾌﾟ宣言（外部非公開)												*/
/*==============================================================================*/
/* なし */


/*==============================================================================*/
/*	内部定数																	*/
/*==============================================================================*/
/* なし */

/****************************************************************************************/
/*	[モジュール名]	IntrDrv_SetMaskLevel	[名称]	割り込みﾏｽｸﾚﾍﾞﾙ設定処理				*/
/*======================================================================================*/
/*	[処理概要]	割り込みマスクレベルを設定します。										*/
/*======================================================================================*/
/*	[記述形式]	SI_8 IntrDrv_SetMaskLevel( UI_16 level )								*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	UI_16					level	：割り込みマスクレベル					*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	SI_8					D_OK	：正常									*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
SI_8 IntrDrv_SetMaskLevel( UI_16 level )
{
	
	/* 割り込みマスクレベルを設定 */
	(void)__set_il(level);
	
	return D_OK;							/* 戻り値 正常*/
}

/****************************************************************************************/
/*	[モジュール名]	IntrDrv_ReqForceIntClk	[名称]	強制時計割込み発生処理				*/
/*======================================================================================*/
/*	[処理概要]	空関数																	*/
/*======================================================================================*/
/*	[記述形式]	void IntrDrv_ReqForceIntClk( void )										*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	空関数。																*/
/****************************************************************************************/
void IntrDrv_ReqForceIntClk( void )
{
	
	/* 空関数 */
	
}

/****************************************************************************************/
/*	[モジュール名]	IntrDrv_GetMaskLevel	[名称]	割り込みマスクレベル取得設定		*/
/*======================================================================================*/
/*	[処理概要]	割り込みマスクレベルを取得します。										*/
/*======================================================================================*/
/*	[記述形式]	SI_8 IntrDrv_GetMaskLevel( UI_16 *level )								*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	SI_8					D_OK	：正常									*/
/*======================================================================================*/
/*	[ 備  考 ]	アセンブラでしか取得できないため、アセンブラコードになります。			*/
/****************************************************************************************/
SI_8 IntrDrv_GetMaskLevel( UI_16 *level )
{
#pragma asm
	STM		(R1,R2)						; R1,R2スタックへ退避
	MOV 	PS,R1						; PS→R1
	LSR		#16,R1						; R1を16bnitシフト(ILMを最下位とする)
	LDI:32	#0x0000001F,R2				; ﾏｽｸ情報(bit4-0)→R2
	AND		R2,R1						; ﾏｽｸ情報&設定値→R1
	STH		R1,@R4						; R1→@R4(引数番地)
	LDM		(R1,R2)						; R1,R2スタックから復帰
#pragma endasm
	
	return D_OK;							/* 戻り値 正常*/
}

/****************************************************************************************/
/*	[モジュール名]	IntrDrv_ReqDelayIntrSet	[名称]	遅延割込み要因のｾｯﾄ処理				*/
/*======================================================================================*/
/*	[処理概要]	遅延割込み要因のﾚｼﾞｽﾀをｾｯﾄする。										*/
/*======================================================================================*/
/*	[記述形式]	void IntrDrv_ReqDelayIntrSet( void )									*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	本関数実行後、遅延割込みが発生します。									*/
/*				遅延割込みが入るﾀｲﾐﾝｸﾞは、他の割込みのﾚﾍﾞﾙ設定によります。				*/
/****************************************************************************************/
void IntrDrv_ReqDelayIntrSet( void )
{
	
	DICR_DLYI = D_ON;		/* 遅延割込み許可ビット 遅延割込み発生 */
	
}

/****************************************************************************************/
/*	[モジュール名]	IntrDrv_ReqDelayIntrClr	[名称]	遅延割り込み要因のｸﾘｱ処理			*/
/*======================================================================================*/
/*	[処理概要]	遅延割込み要因のﾚｼﾞｽﾀをｸﾘｱする。										*/
/*======================================================================================*/
/*	[記述形式]	void IntrDrv_ReqDelayIntrClr( void )									*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
void IntrDrv_ReqDelayIntrClr( void )
{
	
	DICR_DLYI = D_OFF;		/* 遅延割込み許可ビット 遅延割込み解除 */
	
}

/****************************************************************************************/
/*	[モジュール名]	Intr_Drv_Init		[名称]	割込機能ﾄﾞﾗｲﾊﾞﾚｼﾞｽﾀ初期設定処理			*/
/*======================================================================================*/
/*	[処理概要]	レジスタ初期設定時に本関数を呼び、初期化を行う。						*/
/*======================================================================================*/
/*	[記述形式]	void IntrDrv_Init( E_INIT_TYPE req  )									*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	E_INIT_TYPE				req		：起動種別								*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
void IntrDrv_Init( E_INIT_TYPE req )
{
	
	switch ( req ) {
	case E_INIT_RESET:			/* CPUリセットによる起動 */
	case E_INIT_WAKEUP:			/* 省電力解除（WAKEUP）による起動 */
		/* 割込み制御レジスタの初期設定処理 */
		ICR0	=	INIT_ICR00;
		ICR1	=	INIT_ICR01;
		ICR2	=	INIT_ICR02;
		ICR3	=	INIT_ICR03;
		ICR4	=	INIT_ICR04;
		ICR5	=	INIT_ICR05;
		ICR6	=	INIT_ICR06;
		ICR7	=	INIT_ICR07;
		ICR8	=	INIT_ICR08;
		ICR9	=	INIT_ICR09;
		ICR10	=	INIT_ICR10;
		ICR11	=	INIT_ICR11;
		ICR12	=	INIT_ICR12;
		ICR13	=	INIT_ICR13;
		ICR14	=	INIT_ICR14;
		ICR15	=	INIT_ICR15;
		ICR16	=	INIT_ICR16;
		ICR17	=	INIT_ICR17;
		ICR18	=	INIT_ICR18;
		ICR19	=	INIT_ICR19;
		ICR20	=	INIT_ICR20;
		ICR21	=	INIT_ICR21;
		ICR22	=	INIT_ICR22;
		ICR23	=	INIT_ICR23;
		ICR24	=	INIT_ICR24;
		ICR25	=	INIT_ICR25;
		ICR26	=	INIT_ICR26;
		ICR27	=	INIT_ICR27;
		ICR28	=	INIT_ICR28;
		ICR29	=	INIT_ICR29;
		ICR30	=	INIT_ICR30;
		ICR31	=	INIT_ICR31;
		ICR32	=	INIT_ICR32;
		ICR33	=	INIT_ICR33;
		ICR34	=	INIT_ICR34;
		ICR35	=	INIT_ICR35;
		ICR36	=	INIT_ICR36;
		ICR37	=	INIT_ICR37;
		ICR38	=	INIT_ICR38;
		ICR39	=	INIT_ICR39;
		ICR40	=	INIT_ICR40;
		ICR41	=	INIT_ICR41;
		ICR42	=	INIT_ICR42;
		ICR43	=	INIT_ICR43;
		ICR44	=	INIT_ICR44;
		ICR45	=	INIT_ICR45;
		ICR46	=	INIT_ICR46;
		ICR47	=	INIT_ICR47;
		DICR	=	INIT_DICR;	
		break;
	case E_INIT_IGN_ON:			/* IGN ON */
		break;
	case E_INIT_RET_NORMAL_VOL:	/* 低電圧復帰 */
		break;
	case E_INIT_INTERVAL_WAKEUP:	/* 間欠起動ウェイクアップ */
		break;
	default:					/* 上記以外 */
		break;
	}
	
}

/****************************************************************************************/
/*	[モジュール名]	IntrDrv_Sleep	[名称]	割込機能ﾄﾞﾗｲﾊﾞﾚｼﾞｽﾀ再設定処理				*/
/*======================================================================================*/
/*	[処理概要]	省電力モード遷移時に本関数を呼び、初期化を行う。						*/
/*======================================================================================*/
/*	[記述形式]	void IntrDrv_Sleep( void )												*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
void IntrDrv_Sleep( void )
{
	
	/* 割込み制御レジスタの停止設定処理 */
	ICR0	=	STOP_ICR00;
	ICR1	=	STOP_ICR01;
	ICR2	=	STOP_ICR02;
	ICR3	=	STOP_ICR03;
	ICR4	=	STOP_ICR04;
	ICR5	=	STOP_ICR05;
	ICR6	=	STOP_ICR06;
	ICR7	=	STOP_ICR07;
	ICR8	=	STOP_ICR08;
	ICR9	=	STOP_ICR09;
	ICR10	=	STOP_ICR10;
	ICR11	=	STOP_ICR11;
	ICR12	=	STOP_ICR12;
	ICR13	=	STOP_ICR13;
	ICR14	=	STOP_ICR14;
	ICR15	=	STOP_ICR15;
	ICR16	=	STOP_ICR16;
	ICR17	=	STOP_ICR17;
	ICR18	=	STOP_ICR18;
	ICR19	=	STOP_ICR19;
	ICR20	=	STOP_ICR20;
	ICR21	=	STOP_ICR21;
	ICR22	=	STOP_ICR22;
	ICR23	=	STOP_ICR23;
	ICR24	=	STOP_ICR24;
	ICR25	=	STOP_ICR25;
	ICR26	=	STOP_ICR26;
	ICR27	=	STOP_ICR27;
	ICR28	=	STOP_ICR28;
	ICR29	=	STOP_ICR29;
	ICR30	=	STOP_ICR30;
	ICR31	=	STOP_ICR31;
	ICR32	=	STOP_ICR32;
	ICR33	=	STOP_ICR33;
	ICR34	=	STOP_ICR34;
	ICR35	=	STOP_ICR35;
	ICR36	=	STOP_ICR36;
	ICR37	=	STOP_ICR37;
	ICR38	=	STOP_ICR38;
	ICR39	=	STOP_ICR39;
	ICR40	=	STOP_ICR40;
	ICR41	=	STOP_ICR41;
	ICR42	=	STOP_ICR42;
	ICR43	=	STOP_ICR43;
	ICR44	=	STOP_ICR44;
	ICR45	=	STOP_ICR45;
	ICR46	=	STOP_ICR46;
	ICR47	=	STOP_ICR47;
	DICR	=	STOP_DICR;
	
	REGSEL_STRSEL = STBY_REGU_OUT;		/* スタンバイレギュレータ出力を1.2Vにする。 */

}

/****************************************************************************************/
/*	[モジュール名]	IntrDrv_Refresh	[名称]	割込機能ﾄﾞﾗｲﾊﾞﾚｼﾞｽﾀ停止設定処理				*/
/*======================================================================================*/
/*	[処理概要]	レジスタ再設定時に本関数を呼び、初期化を行う。							*/
/*======================================================================================*/
/*	[記述形式]	void IntrDrv_Refresh( void )											*/
/*--------------------------------------------------------------------------------------*/
/*	[ 引  数 ]	無し																	*/
/*--------------------------------------------------------------------------------------*/
/*	[ 戻り値 ]	無し																	*/
/*======================================================================================*/
/*	[ 備  考 ]	無し																	*/
/****************************************************************************************/
void IntrDrv_Refresh( void )
{
	
	/* 空関数 */
	
}

